<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø³Ø¨ÙƒÙŠ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© | Sobky Edu-Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #010409; color: #e6edf3; overflow-x: hidden; }
        .glass { background: rgba(13, 17, 23, 0.95); backdrop-filter: blur(20px); border: 1px solid #30363d; }
        .sidebar { transition: transform 0.3s ease-in-out; z-index: 100; }
        .star-rating { cursor: pointer; font-size: 1.5rem; color: #30363d; transition: color 0.2s; }
        .star-rating.active { color: #f2c94c; }
        .option-btn { background: #21262d; border: 1px solid #30363d; width: 100%; padding: 0.8rem; border-radius: 1rem; text-align: right; margin-bottom: 0.5rem; }
        .correct { background: #238636 !important; }
        .wrong { background: #da3633 !important; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <button id="menuBtn" class="fixed top-5 right-5 z-[110] bg-blue-600 p-2 rounded-lg hidden">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
    </button>

    <div id="sidebar" class="fixed inset-y-0 right-0 w-64 glass sidebar transform translate-x-full p-6 shadow-2xl">
        <h2 class="text-xl font-bold mb-8 text-blue-400 border-b border-gray-700 pb-2">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
        <nav class="space-y-4">
            <button onclick="showAdminPrompt()" class="w-full text-right hover:text-blue-400 transition">ğŸ‘¤ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Admin)</button>
            <button onclick="showSection('vault')" class="w-full text-right hover:text-blue-400 transition">ğŸ“¦ Ø§Ù„Ø®Ø²Ù†Ø© (Ø§Ù„Ù…Ù„ÙØ§Øª)</button>
            <button onclick="showSection('mainDashboard')" class="w-full text-right hover:text-blue-400 transition">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button onclick="showSection('support')" class="w-full text-right hover:text-blue-400 transition">ğŸš© Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ø´ÙƒÙ„Ø©</button>
            <div class="pt-10">
                <button onclick="location.reload()" class="w-full text-right text-red-500">ğŸšª Ø®Ø±ÙˆØ¬</button>
            </div>
        </nav>
    </div>

    <div id="authScreen" class="fixed inset-0 z-[120] flex items-center justify-center bg-[#010409] p-4">
        <div class="glass p-8 rounded-[2rem] w-full max-w-md border-t-4 border-blue-600">
            <h1 class="text-3xl font-bold text-center mb-6">Sobky AI</h1>
            <div class="space-y-4">
                <input type="text" id="uName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full bg-[#0d1117] border border-[#30363d] p-3 rounded-xl outline-none focus:border-blue-500">
                <input type="text" id="uID" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ (ID)" class="w-full bg-[#0d1117] border border-[#30363d] p-3 rounded-xl outline-none focus:border-blue-500">
                <input type="tel" id="uPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†" class="w-full bg-[#0d1117] border border-[#30363d] p-3 rounded-xl outline-none focus:border-blue-500">
                <input type="password" id="uPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full bg-[#0d1117] border border-[#30363d] p-3 rounded-xl outline-none focus:border-blue-500">
                <button onclick="login()" class="w-full bg-blue-600 py-3 rounded-xl font-bold">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</button>
            </div>
        </div>
    </div>

    <div id="contentArea" class="p-4 pt-20 max-w-6xl mx-auto hidden">
        
        <section id="mainDashboard" class="section">
            <div class="flex justify-between items-center mb-6 glass p-4 rounded-xl">
                <h3 class="font-bold">Ø£Ù‡Ù„Ø§Ù‹ØŒ <span id="userName" class="text-blue-400"></span></h3>
                <input type="file" id="fileUpload" class="hidden" accept=".pdf" onchange="processPDF(event)">
                <button onclick="document.getElementById('fileUpload').click()" class="bg-blue-600 px-4 py-1 rounded-lg text-sm">+ Ø±ÙØ¹ PDF</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <button onclick="startMode('study')" class="glass p-6 rounded-2xl border-b-4 border-blue-500">ğŸ’¡ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</button>
                <button onclick="startMode('exam')" class="glass p-6 rounded-2xl border-b-4 border-orange-500">ğŸ“ Ø§Ù…ØªØ­Ø§Ù† (10 Ø£Ø³Ø¦Ù„Ø©)</button>
                <button onclick="startMode('comprehensive')" class="glass p-6 rounded-2xl border-b-4 border-purple-500 md:col-span-2">ğŸ† Ø§Ù…ØªØ­Ø§Ù† Ø´Ø§Ù…Ù„ (30 Ø³Ø¤Ø§Ù„)</button>
            </div>

            <div id="displayArea" class="grid grid-cols-1 lg:grid-cols-2 gap-4 h-[60vh] hidden">
                <div id="pdfView" class="glass p-6 rounded-2xl overflow-y-auto bg-black/20"></div>
                <div id="sideAction" class="glass p-6 rounded-2xl overflow-y-auto"></div>
            </div>
        </section>

        <section id="vault" class="section hidden">
            <h2 class="text-2xl font-bold mb-6">ğŸ“¦ Ø§Ù„Ø®Ø²Ù†Ø© (Ù…Ù„ÙØ§ØªÙƒ)</h2>
            <div id="vaultList" class="space-y-3"></div>
        </section>

        <section id="support" class="section hidden">
            <div class="glass p-8 rounded-3xl max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold mb-6">ğŸš© Ø¥Ø¨Ù„Ø§Øº / Ø§Ù‚ØªØ±Ø§Ø­</h2>
                <div class="space-y-4">
                    <textarea id="issueDesc" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù‡Ù†Ø§..." class="w-full bg-black/20 border border-gray-700 p-4 rounded-xl h-32"></textarea>
                    <textarea id="suggestionDesc" placeholder="Ù„Ø¯ÙŠÙƒ Ø§Ù‚ØªØ±Ø§Ø­ØŸ Ø§ÙƒØªØ¨Ù‡ Ù‡Ù†Ø§..." class="w-full bg-black/20 border border-gray-700 p-4 rounded-xl h-24"></textarea>
                    <div class="flex items-center gap-4">
                        <span>ØªÙ‚ÙŠÙŠÙ…Ùƒ:</span>
                        <div id="starContainer" class="flex gap-1">
                            <span class="star-rating" onclick="setRating(1)">â˜…</span>
                            <span class="star-rating" onclick="setRating(2)">â˜…</span>
                            <span class="star-rating" onclick="setRating(3)">â˜…</span>
                            <span class="star-rating" onclick="setRating(4)">â˜…</span>
                            <span class="star-rating" onclick="setRating(5)">â˜…</span>
                        </div>
                    </div>
                    <button onclick="submitReport()" class="w-full bg-blue-600 py-3 rounded-xl font-bold">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø§Ø¯Ø§Ø±Ø©</button>
                </div>
            </div>
        </section>

        <section id="adminPanel" class="section hidden">
            <h2 class="text-2xl font-bold mb-6 text-red-500">ğŸ›  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ø¯Ù…Ù†)</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-bold mb-4 border-b border-gray-700 pb-2">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† (<span id="countUsers">0</span>)</h3>
                    <div id="adminUsersList" class="space-y-2 text-sm max-h-60 overflow-y-auto"></div>
                </div>
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-bold mb-4 border-b border-gray-700 pb-2">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</h3>
                    <div id="adminReportsList" class="space-y-2 text-sm max-h-60 overflow-y-auto"></div>
                </div>
            </div>
        </section>

    </div>

    <script>
        const API_KEY = "AIzaSyC1BwXz-nHSiFfxh5ux5Y6RexU0FqlD9do";
        const ADMIN_PASS = "1542";
        let currentUser = null;
        let allPDFs = [];
        let currentRating = 0;

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        const menuBtn = document.getElementById('menuBtn');
        const sidebar = document.getElementById('sidebar');
        menuBtn.onclick = () => sidebar.classList.toggle('translate-x-full');

        function login() {
            const name = document.getElementById('uName').value;
            const pass = document.getElementById('uPass').value;
            if(pass === "elsobky12222" && name.length > 2) {
                currentUser = { 
                    name: name, 
                    id: document.getElementById('uID').value, 
                    phone: document.getElementById('uPhone').value 
                };
                // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø§Ø¯Ù…Ù†
                saveUser(currentUser);
                document.getElementById('userName').innerText = name;
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('contentArea').classList.remove('hidden');
                document.getElementById('menuBtn').classList.remove('hidden');
            } else { alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©!"); }
        }

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            sidebar.classList.add('translate-x-full');
            if(id === 'vault') renderVault();
        }

        async function processPDF(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = async function() {
                const typedarray = new Uint8Array(this.result);
                const pdf = await pdfjsLib.getDocument(typedarray).promise;
                let text = "";
                for(let i=1; i<=pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(s => s.str).join(" ") + " ";
                }
                allPDFs.push({ name: file.name, text: text });
                alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ù Ù„Ù„Ø®Ø²Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
                renderVault();
            };
            reader.readAsArrayBuffer(file);
        }

        function renderVault() {
            const list = document.getElementById('vaultList');
            list.innerHTML = allPDFs.map((pdf, i) => `
                <div onclick="openPDFFromVault(${i})" class="glass p-4 rounded-xl flex justify-between cursor-pointer hover:border-blue-500 transition">
                    <span>ğŸ“„ ${pdf.name}</span>
                    <span class="text-blue-400 text-xs font-bold">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© â†</span>
                </div>
            `).join('');
        }

        function openPDFFromVault(idx) {
            showSection('mainDashboard');
            const pdf = allPDFs[idx];
            document.getElementById('displayArea').classList.remove('hidden');
            const words = pdf.text.split(/\s+/);
            document.getElementById('pdfView').innerHTML = words.map(w => `<span onclick="translate(this)" class="cursor-pointer hover:text-blue-400">${w} </span>`).join('');
        }

        async function translate(el) {
            const word = el.innerText.trim();
            const side = document.getElementById('sideAction');
            side.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø©...";
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                method: "POST",
                body: JSON.stringify({ contents: [{ parts: [{ text: `Translate to Arabic: ${word}` }] }] })
            });
            const data = await res.json();
            side.innerHTML = `<div class='p-4 bg-blue-600/10 rounded-xl'><h4 class='font-bold text-blue-400'>${word}</h4><p class='text-2xl mt-2'>${data.candidates[0].content.parts[0].text}</p></div>`;
        }

        // Ù„ÙˆØ­Ø© Ø§Ù„Ø§Ø¯Ù…Ù†
        function showAdminPrompt() {
            const p = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:");
            if(p === ADMIN_PASS) {
                showSection('adminPanel');
                renderAdminData();
            } else { alert("ÙƒÙ„Ù…Ø© Ø³Ø± Ø®Ø§Ø·Ø¦Ø©!"); }
        }

        function saveUser(user) {
            let users = JSON.parse(localStorage.getItem('sobky_users') || "[]");
            if(!users.find(u => u.phone === user.phone)) {
                users.push(user);
                localStorage.setItem('sobky_users', JSON.stringify(users));
            }
        }

        function setRating(n) {
            currentRating = n;
            const stars = document.querySelectorAll('.star-rating');
            stars.forEach((s, i) => s.classList.toggle('active', i < n));
        }

        function submitReport() {
            const report = {
                user: currentUser.name,
                issue: document.getElementById('issueDesc').value,
                sugg: document.getElementById('suggestionDesc').value,
                rate: currentRating
            };
            let reports = JSON.parse(localStorage.getItem('sobky_reports') || "[]");
            reports.push(report);
            localStorage.setItem('sobky_reports', JSON.stringify(reports));
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù„Ø§ØºÙƒ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­");
            showSection('mainDashboard');
        }

        function renderAdminData() {
            const users = JSON.parse(localStorage.getItem('sobky_users') || "[]");
            const reports = JSON.parse(localStorage.getItem('sobky_reports') || "[]");
            
            document.getElementById('countUsers').innerText = users.length;
            document.getElementById('adminUsersList').innerHTML = users.map(u => `
                <div class="p-2 border-b border-gray-800">ğŸ‘¤ ${u.name} | ğŸ†” ${u.id} | ğŸ“± ${u.phone}</div>
            `).join('');
            
            document.getElementById('adminReportsList').innerHTML = reports.map(r => `
                <div class="p-3 bg-white/5 rounded-lg mb-2">
                    <p class="text-blue-400 font-bold">Ù…Ù†: ${r.user} | ØªÙ‚ÙŠÙŠÙ…: ${r.rate}â­</p>
                    <p class="text-red-400 text-xs">Ù…Ø´ÙƒÙ„Ø©: ${r.issue}</p>
                    <p class="text-green-400 text-xs">Ø§Ù‚ØªØ±Ø§Ø­: ${r.sugg}</p>
                </div>
            `).join('');
        }

        async function startMode(mode) {
            if(allPDFs.length === 0) return alert("Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹!");
            const side = document.getElementById('sideAction');
            document.getElementById('displayArea').classList.remove('hidden');
            
            let text = (mode === 'comprehensive') ? allPDFs.map(p => p.text).join(" ") : allPDFs[allPDFs.length-1].text;
            let count = (mode === 'comprehensive') ? 30 : 10;
            
            side.innerHTML = `Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ ${count} Ø³Ø¤Ø§Ù„...`;
            const prompt = `Text: "${text.substring(0, 4000)}". Generate ${count} MCQ in Arabic. JSON: [{"q":"..","o":["..","..","..",".."],"a":index}]`;
            
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: "POST",
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                const questions = JSON.parse(data.candidates[0].content.parts[0].text.replace(/```json|```/g, ""));
                
                let cur = 0, score = 0;
                const renderQ = () => {
                    const q = questions[cur];
                    side.innerHTML = `
                        <div class="text-right">
                            <h3 class="font-bold mb-4">${q.q}</h3>
                            ${q.o.map((o, i) => `<button onclick="checkAns(${i},${q.a},this)" class="option-btn">${o}</button>`).join('')}
                            <button id="nextBtn" disabled onclick="nextQ()" class="w-full mt-4 bg-white text-black py-2 rounded-xl opacity-20">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                        </div>
                    `;
                };
                window.checkAns = (idx, ans, btn) => {
                    const btns = document.querySelectorAll('.option-btn');
                    btns.forEach(b => b.disabled = true);
                    if(idx === ans) { btn.classList.add('correct'); score++; }
                    else { btn.classList.add('wrong'); btns[ans].classList.add('correct'); }
                    document.getElementById('nextBtn').disabled = false;
                    document.getElementById('nextBtn').style.opacity = "1";
                };
                window.nextQ = () => {
                    cur++; if(cur < count) renderQ();
                    else side.innerHTML = `<h2 class='text-4xl text-center font-bold'>${score}/${count}</h2>`;
                };
                renderQ();
            } catch(e) { side.innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©."; }
        }
    </script>
</body>
</html>
