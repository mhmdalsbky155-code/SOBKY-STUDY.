<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sobky AI - Ø§Ù„Ù…Ø³ØªÙ‚Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #0d1117; color: #e6edf3; overflow-x: hidden; }
        .glass { background: rgba(22, 27, 34, 0.95); backdrop-filter: blur(10px); border: 1px solid #30363d; }
        .full-page { position: fixed; inset: 0; z-index: 1000; background: #0d1117; display: none; flex-direction: column; }
        .pdf-canvas-container { flex: 1; overflow-y: auto; background: #525659; display: flex; flex-direction: column; align-items: center; padding: 10px; }
        canvas { margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); max-width: 100%; height: auto !important; }
        .option-btn { background: #21262d; border: 1px solid #30363d; width: 100%; padding: 1rem; border-radius: 1rem; text-align: right; margin-bottom: 0.6rem; transition: 0.2s; }
        .correct { background: #238636 !important; border-color: #2ea043 !important; }
        .wrong { background: #da3633 !important; border-color: #f85149 !important; }
        .loader { width: 40px; height: 40px; border: 4px solid #30363d; border-top-color: #58a6ff; border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="authBox" class="fixed inset-0 z-[2000] flex items-center justify-center bg-[#0d1117] p-4">
        <div class="glass p-8 rounded-[2rem] w-full max-w-md shadow-2xl">
            <h1 class="text-3xl font-bold text-center mb-8 text-blue-500 italic">Sobky AI</h1>
            <div class="space-y-4 text-right">
                <input type="text" id="nameInp" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full bg-[#010409] border border-[#30363d] p-4 rounded-xl outline-none">
                <input type="password" id="passInp" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" class="w-full bg-[#010409] border border-[#30363d] p-4 rounded-xl outline-none">
                <button onclick="login()" class="w-full bg-blue-600 py-4 rounded-xl font-bold active:scale-95 transition">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©</button>
            </div>
        </div>
    </div>

    <div id="dash" class="hidden p-6 pt-20 max-w-5xl mx-auto text-right">
        <div class="glass p-6 rounded-3xl mb-8 flex justify-between items-center shadow-lg">
            <div>Ø£Ù‡Ù„Ø§Ù‹ØŒ <span id="uName" class="text-blue-400 font-bold"></span></div>
            <button onclick="document.getElementById('pdfUp').click()" class="bg-blue-600 px-6 py-2 rounded-xl text-sm font-bold">+ Ø±ÙØ¹ PDF</button>
            <input type="file" id="pdfUp" class="hidden" accept=".pdf" onchange="handlePDF(event)">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <button onclick="openStudy()" class="glass p-8 rounded-[2rem] border-b-8 border-blue-500 active:scale-95 transition flex flex-col items-center gap-4">
                <span class="text-5xl">ğŸ“–</span><span class="font-bold">ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</span>
            </button>
            <button onclick="startQuiz(10)" class="glass p-8 rounded-[2rem] border-b-8 border-orange-500 active:scale-95 transition flex flex-col items-center gap-4">
                <span class="text-5xl">ğŸ“</span><span class="font-bold">Ø§Ù…ØªØ­Ø§Ù† (10Ø³)</span>
            </button>
            <button onclick="startQuiz(30)" class="glass p-8 rounded-[2rem] border-b-8 border-purple-500 active:scale-95 transition flex flex-col items-center gap-4">
                <span class="text-5xl">ğŸ†</span><span class="font-bold">Ø§Ù…ØªØ­Ø§Ù† Ø´Ø§Ù…Ù„</span>
            </button>
        </div>
    </div>

    <div id="studyPage" class="full-page">
        <div class="p-4 glass flex justify-between items-center z-[1100]">
            <button onclick="closePage('studyPage')" class="bg-red-600 px-6 py-2 rounded-xl font-bold">Ø®Ø±ÙˆØ¬</button>
            <div class="flex gap-2">
                <input type="text" id="tWord" placeholder="ÙƒÙ„Ù…Ø© Ù„Ù„ØªØ±Ø¬Ù…Ø©..." class="bg-[#010409] border border-[#30363d] px-4 py-2 rounded-xl text-sm outline-none w-32">
                <button onclick="translateNow()" class="bg-blue-600 px-4 py-2 rounded-xl font-bold text-xs">ØªØ±Ø¬Ù…</button>
            </div>
        </div>
        <div id="pdfContainer" class="pdf-canvas-container">
            <p id="pdfStatus" class="mt-20">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙØ­Ø§Øª...</p>
        </div>
        <div id="tResult" class="p-4 glass text-center font-bold text-blue-400 min-h-[60px] shadow-2xl">Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
    </div>

    <div id="quizPage" class="full-page items-center justify-center p-4">
        <div class="w-full max-w-xl glass p-8 rounded-[2.5rem] relative">
            <button onclick="closePage('quizPage')" class="absolute top-4 left-4 text-gray-500 text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
            <div id="quizContent" class="text-center"></div>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyC1BwXz-nHSiFfxh5ux5Y6RexU0FqlD9do";
        let pdfDocs = [], currentDoc = null, fullText = "";

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        function login() {
            if(document.getElementById('passInp').value === "elsobky12222") {
                document.getElementById('uName').innerText = document.getElementById('nameInp').value;
                document.getElementById('authBox').style.display = 'none';
                document.getElementById('dash').style.display = 'block';
            } else alert("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø®Ø·Ø£!");
        }

        async function handlePDF(e) {
            const file = e.target.files[0]; if(!file) return;
            const reader = new FileReader();
            reader.onload = async function() {
                const typedarray = new Uint8Array(this.result);
                const pdf = await pdfjsLib.getDocument(typedarray).promise;
                currentDoc = pdf;
                let text = "";
                for(let i=1; i<=pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(s => s.str).join(" ") + " ";
                }
                fullText = text.substring(0, 15000); // Ø­ÙØ¸ Ø¹ÙŠÙ†Ø© Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
                pdfDocs.push({ name: file.name, doc: pdf });
                alert("ØªÙ… ØªØ­Ù…ÙŠÙ„ " + file.name + " Ø¨Ù†Ø¬Ø§Ø­!");
            };
            reader.readAsArrayBuffer(file);
        }

        async function openStudy() {
            if(!currentDoc) return alert("Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹!");
            document.getElementById('studyPage').style.display = 'flex';
            const container = document.getElementById('pdfContainer');
            container.innerHTML = "";
            
            for(let i=1; i<=currentDoc.numPages; i++) {
                const page = await currentDoc.getPage(i);
                const viewport = page.getViewport({ scale: 1.5 });
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                container.appendChild(canvas);
                await page.render({ canvasContext: context, viewport: viewport }).promise;
            }
        }

        function closePage(id) { document.getElementById(id).style.display = 'none'; }

        async function translateNow() {
            const w = document.getElementById('tWord').value;
            if(!w) return;
            document.getElementById('tResult').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø©...";
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: "POST", body: JSON.stringify({ contents: [{ parts: [{ text: `Translate precisely to Arabic: "${w}"` }] }] })
                });
                const data = await res.json();
                document.getElementById('tResult').innerText = data.candidates[0].content.parts[0].text;
            } catch(e) { document.getElementById('tResult').innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„."; }
        }

        async function startQuiz(count) {
            if(!fullText) return alert("Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹!");
            document.getElementById('quizPage').style.display = 'flex';
            const box = document.getElementById('quizContent');
            box.innerHTML = `<div class="loader mx-auto"></div><p>Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø°ÙƒØ§Ø¡...</p>`;
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ø§Ù„Ø·Ø¨ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù†Ø¬Ø§Ø­
            const cleanText = fullText.replace(/[^\w\s\u0600-\u06FF]/g, ' ').substring(0, 4000);

            const prompt = `Based on: "${cleanText}", generate ${count} MCQ in Arabic. Format strictly as JSON array ONLY: [{"q":"..","o":["..","..","..",".."],"a":index}]`;
            
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: "POST", body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                const jsonText = data.candidates[0].content.parts[0].text.replace(/```json|```/g, "").trim();
                const qs = JSON.parse(jsonText);
                
                let cur = 0, score = 0;
                const renderQ = () => {
                    const q = qs[cur];
                    box.innerHTML = `
                        <div class="text-right">
                            <span class="bg-blue-600 px-3 py-1 rounded-full text-xs font-bold mb-4 inline-block">Ø³Ø¤Ø§Ù„ ${cur+1}/${count}</span>
                            <h3 class="font-bold text-lg mb-8 leading-relaxed">${q.q}</h3>
                            <div class="space-y-3">${q.o.map((o, i) => `<button onclick="check(${i}, ${q.a}, this)" class="option-btn text-sm">${o}</button>`).join('')}</div>
                            <button id="nxtBtn" disabled onclick="nextQ()" class="w-full mt-10 bg-white text-black py-4 rounded-2xl font-bold opacity-20">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
                        </div>
                    `;
                };
                window.check = (i, a, btn) => {
                    const btns = document.querySelectorAll('.option-btn'); btns.forEach(b => b.disabled = true);
                    if(i === a) { btn.classList.add('correct'); score++; }
                    else { btn.classList.add('wrong'); btns[a].classList.add('correct'); }
                    document.getElementById('nxtBtn').disabled = false; document.getElementById('nxtBtn').style.opacity = "1";
                };
                window.nextQ = () => {
                    cur++; if(cur < count) renderQ();
                    else box.innerHTML = `<h2 class="text-6xl font-bold mb-6">${score}/${count}</h2><button onclick="closePage('quizPage')" class="bg-blue-600 px-10 py-3 rounded-2xl font-bold">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>`;
                };
                renderQ();
            } catch(e) { box.innerHTML = "<p class='text-red-500'>ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>"; }
        }
    </script>
</body>
</html> 
