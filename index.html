<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø³Ø¨ÙƒÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© | Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #010409; color: #e6edf3; overflow: hidden; }
        .glass { background: rgba(13, 17, 23, 0.98); backdrop-filter: blur(25px); border: 1px solid #30363d; }
        .full-page { position: fixed; inset: 0; z-index: 500; background: #010409; display: none; flex-direction: column; }
        .pdf-frame { width: 100%; height: 100%; border: none; background: #525659; }
        .option-btn { background: #21262d; border: 1px solid #30363d; width: 100%; padding: 1.2rem; border-radius: 1.5rem; text-align: right; margin-bottom: 0.8rem; }
        .correct { background: #238636 !important; }
        .wrong { background: #da3633 !important; }
        .loader { width: 60px; height: 60px; border: 6px solid #30363d; border-top-color: #58a6ff; border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <button id="menuBtn" class="fixed top-6 right-6 z-[1100] bg-blue-600 p-3 rounded-2xl hidden shadow-2xl">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
    </button>
    <div id="sidebar" class="fixed inset-y-0 right-0 w-80 glass transform translate-x-full p-8 shadow-2xl z-[1050] transition-transform text-right">
        <h2 class="text-2xl font-bold mb-10 text-blue-500 italic">Sobky Admin</h2>
        <nav class="space-y-6 font-bold">
            <button onclick="checkAdmin()" class="w-full text-right hover:text-blue-400">ğŸ‘¤ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
            <button onclick="openTab('vaultPage')" class="w-full text-right text-green-400">ğŸ“¦ Ø§Ù„Ø®Ø²Ù†Ø©</button>
            <button onclick="location.reload()" class="w-full text-right text-red-500 mt-20">ğŸšª Ø®Ø±ÙˆØ¬</button>
        </nav>
        <div class="absolute bottom-10 left-8 right-8 p-5 bg-blue-900/20 rounded-[2rem] text-center border border-blue-800/30">
            <div id="sessionTimer" class="text-3xl font-bold text-blue-400">00:00:00</div>
        </div>
    </div>

    <div id="loginScreen" class="fixed inset-0 z-[1200] flex items-center justify-center bg-[#010409] p-4 text-right">
        <div class="glass p-10 rounded-[3rem] w-full max-w-md border-t-8 border-blue-600 shadow-2xl">
            <h1 class="text-4xl font-bold text-center mb-10 text-blue-500 italic">Sobky</h1>
            <div class="space-y-4">
                <input type="text" id="nameInp" placeholder="Ø§Ù„Ø§Ø³Ù…" class="w-full bg-[#0d1117] border border-[#30363d] p-4 rounded-2xl outline-none">
                <input type="password" id="passInp" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" class="w-full bg-[#0d1117] border border-[#30363d] p-4 rounded-2xl outline-none">
                <button onclick="doLogin()" class="w-full bg-blue-600 py-4 rounded-2xl font-bold active:scale-95 transition shadow-lg">Ø¯Ø®ÙˆÙ„</button>
            </div>
        </div>
    </div>

    <div id="mainDash" class="p-6 pt-24 max-w-6xl mx-auto hidden text-right text-right">
        <div class="glass p-6 rounded-3xl mb-10 flex justify-between items-center shadow-lg">
            <div>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="uName" class="text-blue-400 font-bold"></span></div>
            <button onclick="document.getElementById('pdfInp').click()" class="bg-blue-600 px-6 py-2 rounded-xl text-sm font-bold shadow-lg">+ Ø±ÙØ¹ PDF</button>
            <input type="file" id="pdfInp" class="hidden" accept=".pdf" onchange="handlePDF(event)">
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <button onclick="openTab('studyPage')" class="glass p-10 rounded-[2.5rem] flex flex-col items-center gap-4 border-b-8 border-blue-500">
                <span class="text-5xl">ğŸ“–</span><span class="text-xl font-bold">Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</span>
            </button>
            <button onclick="startExam(10)" class="glass p-10 rounded-[2.5rem] flex flex-col items-center gap-4 border-b-8 border-orange-500">
                <span class="text-5xl">ğŸ“</span><span class="text-xl font-bold">Ø§Ù…ØªØ­Ø§Ù† (10Ø³)</span>
            </button>
            <button onclick="startExam(30)" class="glass p-10 rounded-[2.5rem] flex flex-col items-center gap-4 border-b-8 border-purple-500">
                <span class="text-5xl">ğŸ†</span><span class="text-xl font-bold">Ø´Ø§Ù…Ù„ (30Ø³)</span>
            </button>
        </div>
    </div>

    <div id="studyPage" class="full-page">
        <div class="flex flex-col h-full">
            <div class="p-4 glass flex justify-between items-center border-b border-gray-800">
                <button onclick="closeTab('studyPage')" class="bg-red-500 px-6 py-2 rounded-xl font-bold">Ø®Ø±ÙˆØ¬</button>
                <div class="flex gap-2">
                    <input type="text" id="wordInp" placeholder="ØªØ±Ø¬Ù… ÙƒÙ„Ù…Ø© Ø·Ø¨ÙŠØ©..." class="bg-black/50 border border-gray-700 px-4 py-2 rounded-xl text-sm outline-none">
                    <button onclick="translateWord()" class="bg-blue-600 px-4 py-2 rounded-xl font-bold text-xs">ØªØ±Ø¬Ù…</button>
                </div>
            </div>
            <div class="flex-1 bg-[#525659] p-2">
                <iframe id="viewerFrame" class="pdf-frame"></iframe>
            </div>
            <div id="transBox" class="p-4 glass text-center font-bold text-blue-400 min-h-[50px]">Ø§ÙƒØªØ¨ Ø£ÙŠ ÙƒÙ„Ù…Ø© ØµØ¹Ø¨Ø© Ù„ØªØ±Ø¬Ù…ØªÙ‡Ø§ ÙÙˆØ±Ø§Ù‹</div>
        </div>
    </div>

    <div id="examPage" class="full-page flex flex-col items-center justify-center p-6">
        <div class="w-full max-w-2xl glass p-10 rounded-[3rem] shadow-2xl relative">
            <button onclick="closeTab('examPage')" class="absolute top-6 left-6 text-gray-500">Ø¥ØºÙ„Ø§Ù‚</button>
            <div id="examMain" class="text-center"></div>
        </div>
    </div>

    <div id="vaultPage" class="full-page p-10 text-right"><h2 class="text-3xl mb-10 font-bold">ğŸ“¦ Ø§Ù„Ø®Ø²Ù†Ø©</h2><div id="vList" class="grid gap-4"></div><button onclick="closeTab('vaultPage')" class="mt-10 text-gray-500">Ø±Ø¬ÙˆØ¹</button></div>

    <script>
        const API_KEY = "AIzaSyC1BwXz-nHSiFfxh5ux5Y6RexU0FqlD9do";
        let user = null, files = [], secs = 0;

        // Ø§Ù„Ø¹Ø¯Ø§Ø¯
        setInterval(() => { if(user) { secs++; updateT(); } }, 1000);
        function updateT() {
            const h = Math.floor(secs/3600).toString().padStart(2,'0');
            const m = Math.floor((secs%3600)/60).toString().padStart(2,'0');
            const s = (secs%60).toString().padStart(2,'0');
            document.getElementById('sessionTimer').innerText = `${h}:${m}:${s}`;
        }

        function doLogin() {
            const n = document.getElementById('nameInp').value, p = document.getElementById('passInp').value;
            if(p === "elsobky12222" && n.length > 2) {
                user = { name: n }; document.getElementById('uName').innerText = n;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainDash').style.display = 'block';
                document.getElementById('menuBtn').style.display = 'block';
            } else alert("Ø®Ø·Ø£!");
        }

        async function handlePDF(e) {
            const file = e.target.files[0]; if(!file) return;
            const url = URL.createObjectURL(file);
            const reader = new FileReader();
            reader.onload = async function() {
                const typed = new Uint8Array(this.result);
                const pdf = await pdfjsLib.getDocument(typed).promise;
                let text = "";
                for(let i=1; i<=pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(s => s.str).join(" ") + " ";
                }
                files.push({ name: file.name, url: url, text: text });
                alert("ØªÙ… Ø±ÙØ¹ " + file.name + " Ø¨Ù†Ø¬Ø§Ø­!");
            };
            reader.readAsArrayBuffer(file);
        }

        function openTab(id) {
            if((id==='studyPage' || id==='examPage') && files.length === 0) return alert("Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹!");
            document.getElementById(id).style.display = 'flex';
            document.getElementById('sidebar').classList.add('translate-x-full');
            if(id === 'studyPage') document.getElementById('viewerFrame').src = files[files.length-1].url;
            if(id === 'vaultPage') renderV();
        }

        function closeTab(id) { document.getElementById(id).style.display = 'none'; }

        async function translateWord() {
            const w = document.getElementById('wordInp').value;
            const res = document.getElementById('transBox');
            if(!w) return; res.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø©...";
            try {
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: "POST", body: JSON.stringify({ contents: [{ parts: [{ text: `Translate medical term "${w}" to Arabic.` }] }] })
                });
                const d = await r.json();
                res.innerText = d.candidates[0].content.parts[0].text;
            } catch(e) { res.innerText = "Error"; }
        }

        async function startExam(count) {
            if(files.length === 0) return alert("Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹!");
            openTab('examPage');
            const main = document.getElementById('examMain');
            main.innerHTML = `<div class="loader"></div><p>Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ ${count} Ø³Ø¤Ø§Ù„ Ø·Ø¨ÙŠ Ø°ÙƒÙŠ Ù…Ù† Ù…Ù„ÙÙƒ...</p>`;
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù†Ø¬Ø§Ø­
            const sourceText = count === 30 ? files.map(f => f.text).join(" ") : files[files.length-1].text;
            const cleanSource = sourceText.substring(0, 4200).replace(/[^\w\s\u0600-\u06FF]/g, ' ');

            const prompt = `Based on: "${cleanSource}", generate ${count} MCQ in Arabic. Respond ONLY with valid JSON array: [{"q":"..","o":["..","..","..",".."],"a":index}]`;
            
            try {
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: "POST", body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const d = await r.json();
                const jsonStr = d.candidates[0].content.parts[0].text.replace(/```json|```/g, "").trim();
                const qs = JSON.parse(jsonStr);
                
                let cur = 0, score = 0;
                const showQ = () => {
                    const q = qs[cur];
                    main.innerHTML = `
                        <div class="text-right">
                            <span class="bg-blue-600 px-4 py-1 rounded-full text-xs font-bold mb-6 inline-block">Ø³Ø¤Ø§Ù„ ${cur+1}/${count}</span>
                            <h3 class="font-bold text-xl mb-10 leading-relaxed">${q.q}</h3>
                            <div class="space-y-3">${q.o.map((o, i) => `<button onclick="checkAns(${i}, ${q.a}, this)" class="option-btn text-sm">${o}</button>`).join('')}</div>
                            <button id="nxtB" disabled onclick="nextQ()" class="w-full mt-10 bg-white text-black py-4 rounded-2xl font-bold opacity-20 transition">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
                        </div>
                    `;
                };
                window.checkAns = (i, a, btn) => {
                    const btns = document.querySelectorAll('.option-btn'); btns.forEach(b => b.disabled = true);
                    if(i === a) { btn.classList.add('correct'); score++; } else { btn.classList.add('wrong'); btns[a].classList.add('correct'); }
                    document.getElementById('nxtB').disabled = false; document.getElementById('nxtB').style.opacity = "1";
                };
                window.nextQ = () => {
                    cur++; if(cur < count) showQ();
                    else main.innerHTML = `<h2 class="text-7xl font-bold mb-6">${score}/${count}</h2><button onclick="closeTab('examPage')" class="bg-blue-600 px-10 py-3 rounded-2xl font-bold">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>`;
                };
                showQ();
            } catch(e) { main.innerHTML = "<p class='text-red-500'>ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø³Ø¨Ø¨ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙƒØ¨ÙŠØ±. Ø¬Ø±Ø¨ ØªØ±ÙØ¹ Ù…Ù„Ù Ø£ØµØºØ± Ø´ÙˆÙŠØ© Ø£Ùˆ Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ.</p>"; }
        }

        function checkAdmin() { if(prompt("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯:") === "1542") openTab('vaultPage'); else alert("Ø®Ø·Ø£!"); }
        function renderV() { document.getElementById('vList').innerHTML = files.map(f => `<div class="glass p-4 rounded-xl">ğŸ“„ ${f.name}</div>`).join(''); }
        document.getElementById('menuBtn').onclick = () => document.getElementById('sidebar').classList.toggle('translate-x-full');
    </script>
</body>
</html>
