<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø³Ø¨ÙƒÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #010409; color: #e6edf3; overflow: hidden; }
        .glass { background: rgba(13, 17, 23, 0.98); backdrop-filter: blur(20px); border: 1px solid #30363d; }
        .full-page { position: fixed; inset: 0; z-index: 500; background: #010409; display: none; flex-direction: column; }
        .sidebar { transition: 0.3s; z-index: 1000; }
        iframe { width: 100%; height: 100%; border: none; background: white; border-radius: 15px; }
        .option-btn { background: #21262d; border: 1px solid #30363d; width: 100%; padding: 1.2rem; border-radius: 1.5rem; text-align: right; margin-bottom: 0.8rem; transition: 0.3s; }
        .correct { background: #238636 !important; }
        .wrong { background: #da3633 !important; }
        .loader { width: 50px; height: 50px; border: 5px solid #30363d; border-top-color: #58a6ff; border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loginScreen" class="fixed inset-0 z-[1200] flex items-center justify-center bg-[#010409] p-4 text-right">
        <div class="glass p-10 rounded-[3rem] w-full max-w-md border-t-8 border-blue-600 shadow-2xl">
            <h1 class="text-4xl font-bold text-center mb-10 text-blue-500 italic">Sobky AI</h1>
            <div class="space-y-4">
                <input type="text" id="uName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full bg-[#0d1117] border border-[#30363d] p-4 rounded-2xl outline-none">
                <input type="password" id="uPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" class="w-full bg-[#0d1117] border border-[#30363d] p-4 rounded-2xl outline-none">
                <button onclick="login()" class="w-full bg-blue-600 py-4 rounded-2xl font-bold text-xl active:scale-95 transition">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©</button>
            </div>
        </div>
    </div>

    <div id="mainDashboard" class="p-6 pt-24 max-w-6xl mx-auto hidden text-right">
        <div class="glass p-6 rounded-3xl mb-10 flex justify-between items-center shadow-lg border border-white/5">
            <div>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="displayName" class="text-blue-400 font-bold"></span></div>
            <button onclick="document.getElementById('pdfInp').click()" class="bg-blue-600 px-6 py-2 rounded-xl text-sm font-bold shadow-lg">+ Ø±ÙØ¹ Ù…Ù„Ù PDF</button>
            <input type="file" id="pdfInp" class="hidden" accept=".pdf" onchange="uploadPDF(event)">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div onclick="openPage('studyPage')" class="glass p-10 rounded-[2.5rem] flex flex-col items-center gap-6 cursor-pointer border-b-8 border-blue-500 hover:bg-blue-500/5 transition active:scale-95">
                <span class="text-6xl">ğŸ“–</span><span class="text-2xl font-bold">Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</span>
            </div>
            <div onclick="generateExam(10)" class="glass p-10 rounded-[2.5rem] flex flex-col items-center gap-6 cursor-pointer border-b-8 border-orange-500 hover:bg-orange-500/5 transition active:scale-95">
                <span class="text-6xl">ğŸ“</span><span class="text-2xl font-bold">Ø§Ù…ØªØ­Ø§Ù† (10Ø³)</span>
            </div>
            <div onclick="generateExam(30)" class="glass p-10 rounded-[2.5rem] flex flex-col items-center gap-6 cursor-pointer border-b-8 border-purple-500 hover:bg-purple-500/5 transition active:scale-95">
                <span class="text-6xl">ğŸ†</span><span class="text-2xl font-bold">Ø´Ø§Ù…Ù„ (30Ø³)</span>
            </div>
        </div>
    </div>

    <div id="studyPage" class="full-page">
        <div class="flex flex-col h-full">
            <div class="p-4 glass flex justify-between items-center border-b border-gray-800">
                <button onclick="closePage('studyPage')" class="bg-red-500 px-6 py-2 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
                <div class="flex gap-2">
                    <input type="text" id="tWord" placeholder="ØªØ±Ø¬Ù… Ù…ØµØ·Ù„Ø­ Ø·Ø¨ÙŠ..." class="bg-black/50 border border-gray-700 px-4 py-2 rounded-xl text-sm outline-none">
                    <button onclick="translateQuick()" class="bg-blue-600 px-4 py-2 rounded-xl font-bold text-xs">ØªØ±Ø¬Ù…</button>
                </div>
            </div>
            <div class="flex-1 p-2 bg-[#525659]">
                <iframe id="pdfFrame"></iframe>
            </div>
            <div id="tResult" class="p-4 glass text-center font-bold text-blue-400 min-h-[60px]">Ø§ÙƒØªØ¨ Ø£ÙŠ ÙƒÙ„Ù…Ø© Ø·Ø¨ÙŠØ© Ù„ØªØ±Ø¬Ù…ØªÙ‡Ø§ ÙÙˆØ±Ø§Ù‹</div>
        </div>
    </div>

    <div id="examPage" class="full-page flex flex-col items-center justify-center p-6">
        <div class="w-full max-w-2xl glass p-10 rounded-[3rem] shadow-2xl relative">
            <button onclick="closePage('examPage')" class="absolute top-6 left-6 text-gray-500">Ø®Ø±ÙˆØ¬</button>
            <div id="examMain" class="text-center"></div>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyC1BwXz-nHSiFfxh5ux5Y6RexU0FqlD9do";
        let user = null, files = [];

        function login() {
            const n = document.getElementById('uName').value, p = document.getElementById('uPass').value;
            if(p === "elsobky12222" && n.length > 2) {
                user = { name: n };
                document.getElementById('displayName').innerText = n;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainDashboard').style.display = 'block';
            } else alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©!");
        }

        async function uploadPDF(e) {
            const file = e.target.files[0]; if(!file) return;
            const url = URL.createObjectURL(file);
            const reader = new FileReader();
            reader.onload = async function() {
                const typed = new Uint8Array(this.result);
                const pdf = await pdfjsLib.getDocument(typed).promise;
                let text = "";
                for(let i=1; i<=pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(s => s.str).join(" ") + " ";
                }
                files.push({ name: file.name, url: url, text: text.replace(/\s+/g, ' ').trim() });
                alert("ØªÙ… Ø±ÙØ¹ " + file.name + " Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            };
            reader.readAsArrayBuffer(file);
        }

        function openPage(id) {
            if(files.length === 0) return alert("Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹!");
            document.getElementById(id).style.display = 'flex';
            if(id === 'studyPage') document.getElementById('pdfFrame').src = files[files.length-1].url;
        }

        function closePage(id) { document.getElementById(id).style.display = 'none'; }

        async function translateQuick() {
            const w = document.getElementById('tWord').value;
            const res = document.getElementById('tResult');
            if(!w) return; res.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø©...";
            try {
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: "POST", body: JSON.stringify({ contents: [{ parts: [{ text: `Translate medical term "${w}" to Arabic concisely.` }] }] })
                });
                const d = await r.json();
                res.innerText = d.candidates[0].content.parts[0].text;
            } catch(e) { res.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„"; }
        }

        async function generateExam(count) {
            if(files.length === 0) return alert("Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹!");
            openPage('examPage');
            const main = document.getElementById('examMain');
            main.innerHTML = `<div class="loader mx-auto"></div><p>Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ ${count} Ø³Ø¤Ø§Ù„ Ø°ÙƒÙŠ...</p>`;
            
            const source = count === 30 ? files.map(f => f.text).join(" ") : files[files.length-1].text;
            const cleaned = source.substring(0, 4500); // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù„Ø¶Ù…Ø§Ù† Ù†Ø¬Ø§Ø­ Ø§Ù„Ù€ AI

            const prompt = `Based on: "${cleaned}", generate ${count} MCQ in Arabic. Respond ONLY with JSON array: [{"q":"..","o":["..","..","..",".."],"a":index}]`;
            
            try {
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: "POST", body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const d = await r.json();
                const qs = JSON.parse(d.candidates[0].content.parts[0].text.replace(/```json|```/g, "").trim());
                
                let cur = 0, score = 0;
                const showQ = () => {
                    const q = qs[cur];
                    main.innerHTML = `
                        <div class="text-right">
                            <span class="bg-blue-600 px-3 py-1 rounded-full text-xs font-bold mb-6 inline-block">Ø³Ø¤Ø§Ù„ ${cur+1}/${count}</span>
                            <h3 class="font-bold text-xl mb-10 leading-relaxed">${q.q}</h3>
                            <div class="space-y-3">${q.o.map((o, i) => `<button onclick="checkAns(${i}, ${q.a}, this)" class="option-btn">${o}</button>`).join('')}</div>
                            <button id="nxtBtn" disabled onclick="nextQ()" class="w-full mt-10 bg-white text-black py-4 rounded-2xl font-bold opacity-20">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
                        </div>
                    `;
                };
                window.checkAns = (i, a, btn) => {
                    const btns = document.querySelectorAll('.option-btn'); btns.forEach(b => b.disabled = true);
                    if(i === a) { btn.classList.add('correct'); score++; } else { btn.classList.add('wrong'); btns[a].classList.add('correct'); }
                    document.getElementById('nxtBtn').disabled = false; document.getElementById('nxtBtn').style.opacity = "1";
                };
                window.nextQ = () => {
                    cur++; if(cur < count) showQ();
                    else main.innerHTML = `<h2 class="text-7xl font-bold mb-6 text-blue-500">${score}/${count}</h2><button onclick="closePage('examPage')" class="bg-blue-600 px-10 py-3 rounded-2xl font-bold">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>`;
                };
                showQ();
            } catch(e) { main.innerHTML = "<p class='text-red-500 font-bold'>Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø³Ø¨Ø¨ ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„Ù…Ù„Ù. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ù…Ù„Ù Ø£ØµØºØ± Ù‚Ù„ÙŠÙ„Ø§Ù‹.</p>"; }
        }
    </script>
</body>
    </html> 
